from .. import loader
import asyncio
from telethon.tl.functions.account import UpdateStatusRequest

@loader.tds
class AlwaysOfflineMod(loader.Module):
    """–ü–æ–ª–Ω—ã–π –æ—Ñ—Ñ–ª–∞–π–Ω. –°–∫—Ä—ã–≤–∞–µ—Ç online –ø–æ–ª–Ω–æ—Å—Ç—å—é."""

    strings = {"name": "AlwaysOffline"}

    async def client_ready(self, client, db):
        self.client = client
        self._running = True
        self.task = asyncio.create_task(self._loop())

    async def _loop(self):
        """–ü–æ—Å—Ç–æ—è–Ω–Ω–æ —Å—Ç–∞–≤–∏—Ç —Å—Ç–∞—Ç—É—Å offline."""
        while self._running:
            try:
                await self.client(UpdateStatusRequest(offline=True))
            except:
                pass
            await asyncio.sleep(3)

    async def enableofflinecmd(self, message):
        """–í–∫–ª—é—á–∏—Ç—å –≤—Å–µ–≥–¥–∞ offline"""
        if not self._running:
            self._running = True
            self.task = asyncio.create_task(self._loop())
        await message.edit("üü¢ AlwaysOffline –≤–∫–ª—é—á—ë–Ω")

    async def disableofflinecmd(self, message):
        """–í—ã–∫–ª—é—á–∏—Ç—å –≤—Å–µ–≥–¥–∞ offline"""
        self._running = False
        await message.edit("‚ö™ AlwaysOffline –≤—ã–∫–ª—é—á–µ–Ω")
